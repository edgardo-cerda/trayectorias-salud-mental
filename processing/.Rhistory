'Síntomas intermitentes', 'Sin sintomas/sintomas medios')
N <- table(elsoc_salud_5$trayectoria)
clusters <- c('Sintomas severos recurrentes', 'Remisión sintomas', 'Síntomas severos nuevos',
'Síntomas intermitentes', 'Sin sintomas/sintomas medios')
nombres_cluster <- c('Sintomas severos recurrentes', 'Remisión sintomas', 'Síntomas severos nuevos',
'Síntomas intermitentes', 'Sin sintomas/sintomas medios')
graficos <- purrr::map(.x = 1:5, .f = ~
elsoc_salud_5 %>%
filter(trayectoria == .x) %>%
ggsankey::make_long(depr4_w01, depr4_w02, depr4_w03, depr4_w04, depr4_w05,
value = 'ponderador02_w01') %>%
mutate(depr = factor(node,
levels = 1:4,
labels = c('Sin sintomas', 'medios', 'moderados', 'severos')),
x = factor(x,
levels = glue::glue('depr4_w0{1:5}'),
labels = glue::glue('{c(2016:2019, 2021)}'))) %>%
ggplot(aes(x = x,
next_x = next_x,
node = node,
next_node = next_node,
fill = depr,
value = value)) +
geom_sankey(flow.alpha = .6) +
labs(x = NULL,
caption = glue::glue('N={N[.x]}')) +
theme(legend.position = 'bottom',
legend.title = element_blank()) +
scale_fill_viridis_d(direction = -1, end = .8)   +
ggtitle(NULL, subtitle = '{nombres_cluster[.x]}')
)
plot <- ggpubr::ggarrange(plotlist = graficos,
common.legend = TRUE, legend = 'bottom')
annotate_figure(plot, top = text_grob(glue::glue('5 clusters')))
nombres_cluster <- c('Sintomas severos recurrentes', 'Remisión sintomas', 'Síntomas severos nuevos',
'Síntomas intermitentes', 'Sin sintomas/sintomas medios')
graficos <- purrr::map(.x = 1:5, .f = ~
elsoc_salud_5 %>%
filter(trayectoria == .x) %>%
ggsankey::make_long(depr4_w01, depr4_w02, depr4_w03, depr4_w04, depr4_w05,
value = 'ponderador02_w01') %>%
mutate(depr = factor(node,
levels = 1:4,
labels = c('Sin sintomas', 'medios', 'moderados', 'severos')),
x = factor(x,
levels = glue::glue('depr4_w0{1:5}'),
labels = glue::glue('{c(2016:2019, 2021)}'))) %>%
ggplot(aes(x = x,
next_x = next_x,
node = node,
next_node = next_node,
fill = depr,
value = value)) +
geom_sankey(flow.alpha = .6) +
labs(x = NULL,
caption = glue::glue('N={N[.x]}')) +
theme(legend.position = 'bottom',
legend.title = element_blank()) +
scale_fill_viridis_d(direction = -1, end = .8)   +
ggtitle(NULL, subtitle = '{nombres_cluster[.x]}')
)
N <- table(elsoc_salud_5$trayectoria)
nombres_cluster <- c('Sintomas severos recurrentes', 'Remisión sintomas', 'Síntomas severos nuevos',
'Síntomas intermitentes', 'Sin sintomas/sintomas medios')
graficos <- purrr::map(.x = 1:5, .f = ~
elsoc_salud_5 %>%
filter(trayectoria == .x) %>%
ggsankey::make_long(depr4_w01, depr4_w02, depr4_w03, depr4_w04, depr4_w05,
value = 'ponderador02_w01') %>%
mutate(depr = factor(node,
levels = 1:4,
labels = c('Sin sintomas', 'medios', 'moderados', 'severos')),
x = factor(x,
levels = glue::glue('depr4_w0{1:5}'),
labels = glue::glue('{c(2016:2019, 2021)}'))) %>%
ggplot(aes(x = x,
next_x = next_x,
node = node,
next_node = next_node,
fill = depr,
value = value)) +
geom_sankey(flow.alpha = .6) +
labs(x = NULL,
caption = glue::glue('N={N[.x]}')) +
theme(legend.position = 'bottom',
legend.title = element_blank()) +
scale_fill_viridis_d(direction = -1, end = .8)   +
ggtitle(NULL, subtitle = glue::gleu('{nombres_cluster[.x]}'))
)
N <- table(elsoc_salud_5$trayectoria)
nombres_cluster <- c('Sintomas severos recurrentes', 'Remisión sintomas', 'Síntomas severos nuevos',
'Síntomas intermitentes', 'Sin sintomas/sintomas medios')
graficos <- purrr::map(.x = 1:5, .f = ~
elsoc_salud_5 %>%
filter(trayectoria == .x) %>%
ggsankey::make_long(depr4_w01, depr4_w02, depr4_w03, depr4_w04, depr4_w05,
value = 'ponderador02_w01') %>%
mutate(depr = factor(node,
levels = 1:4,
labels = c('Sin sintomas', 'medios', 'moderados', 'severos')),
x = factor(x,
levels = glue::glue('depr4_w0{1:5}'),
labels = glue::glue('{c(2016:2019, 2021)}'))) %>%
ggplot(aes(x = x,
next_x = next_x,
node = node,
next_node = next_node,
fill = depr,
value = value)) +
geom_sankey(flow.alpha = .6) +
labs(x = NULL,
caption = glue::glue('N={N[.x]}')) +
theme(legend.position = 'bottom',
legend.title = element_blank()) +
scale_fill_viridis_d(direction = -1, end = .8)   +
ggtitle(NULL, subtitle = glue::glue('{nombres_cluster[.x]}'))
)
plot <- ggpubr::ggarrange(plotlist = graficos,
common.legend = TRUE, legend = 'bottom')
annotate_figure(plot, top = text_grob(glue::glue('5 clusters')))
elsoc_salud_5 %>%
filter(trayectoria == 4) %>%
ggsankey::make_long(depr4_w01, depr4_w02, depr4_w03, depr4_w04, depr4_w05,
value = 'ponderador02_w01') %>%
mutate(depr = factor(node,
levels = 1:4,
labels = c('Sin sintomas', 'medios', 'moderados', 'severos')),
x = factor(x,
levels = glue::glue('depr4_w0{1:5}'),
labels = glue::glue('{c(2016:2019, 2021)}'))) %>%
ggplot(aes(x = x,
next_x = next_x,
node = node,
next_node = next_node,
fill = depr,
value = value)) +
geom_sankey(flow.alpha = .6) +
labs(x = NULL,
caption = glue::glue('N={N[4]}')) +
theme(legend.position = 'bottom',
legend.title = element_blank()) +
scale_fill_viridis_d(direction = -1, end = .8)   +
ggtitle(NULL, subtitle = glue::glue('{nombres_cluster[4]}'))
?scale_fill_viridis_d
elsoc_salud_5 %>%
filter(trayectoria == 4) %>%
ggsankey::make_long(depr4_w01, depr4_w02, depr4_w03, depr4_w04, depr4_w05,
value = 'ponderador02_w01') %>%
mutate(depr = factor(node,
levels = 1:4,
labels = c('Sin sintomas', 'medios', 'moderados', 'severos')),
x = factor(x,
levels = glue::glue('depr4_w0{1:5}'),
labels = glue::glue('{c(2016:2019, 2021)}'))) %>%
ggplot(aes(x = x,
next_x = next_x,
node = node,
next_node = next_node,
fill = depr,
value = value)) +
geom_sankey(flow.alpha = .6) +
labs(x = NULL,
caption = glue::glue('N={N[4]}')) +
theme(legend.position = 'bottom',
legend.title = element_blank()) +
scale_fill_viridis_d(values = c(.2, .4, .6, .8))   +
ggtitle(NULL, subtitle = glue::glue('{nombres_cluster[4]}'))
elsoc_salud_5 %>%
filter(trayectoria == 4) %>%
ggsankey::make_long(depr4_w01, depr4_w02, depr4_w03, depr4_w04, depr4_w05,
value = 'ponderador02_w01') %>%
mutate(depr = factor(node,
levels = 1:4,
labels = c('Sin sintomas', 'medios', 'moderados', 'severos')),
x = factor(x,
levels = glue::glue('depr4_w0{1:5}'),
labels = glue::glue('{c(2016:2019, 2021)}'))) %>%
ggplot(aes(x = x,
next_x = next_x,
node = node,
next_node = next_node,
fill = depr,
value = value)) +
geom_sankey(flow.alpha = .6) +
labs(x = NULL,
caption = glue::glue('N={N[4]}')) +
theme(legend.position = 'bottom',
legend.title = element_blank()) +
scale_fill_viridis(values = c(.2, .4, .6, .8))   +
ggtitle(NULL, subtitle = glue::glue('{nombres_cluster[4]}'))
rescale()
elsoc_salud_5 %>%
filter(trayectoria == 4) %>%
ggsankey::make_long(depr4_w01, depr4_w02, depr4_w03, depr4_w04, depr4_w05,
value = 'ponderador02_w01') %>%
mutate(depr = factor(node,
levels = 1:4,
labels = c('Sin sintomas', 'medios', 'moderados', 'severos')),
x = factor(x,
levels = glue::glue('depr4_w0{1:5}'),
labels = glue::glue('{c(2016:2019, 2021)}'))) %>%
ggplot(aes(x = x,
next_x = next_x,
node = node,
next_node = next_node,
fill = depr,
value = value)) +
geom_sankey(flow.alpha = .6) +
labs(x = NULL,
caption = glue::glue('N={N[4]}')) +
theme(legend.position = 'bottom',
legend.title = element_blank()) +
scale_fill_viridis_d(values = c(.2, .4, .6, .8))   +
ggtitle(NULL, subtitle = glue::glue('{nombres_cluster[4]}'))
elsoc_salud_5 %>%
filter(trayectoria == 4) %>%
ggsankey::make_long(depr4_w01, depr4_w02, depr4_w03, depr4_w04, depr4_w05,
value = 'ponderador02_w01') %>%
mutate(depr = factor(node,
levels = 1:4,
labels = c('Sin sintomas', 'medios', 'moderados', 'severos')),
x = factor(x,
levels = glue::glue('depr4_w0{1:5}'),
labels = glue::glue('{c(2016:2019, 2021)}'))) %>%
ggplot(aes(x = x,
next_x = next_x,
node = node,
next_node = next_node,
fill = depr,
value = value)) +
geom_sankey(flow.alpha = .6) +
labs(x = NULL,
caption = glue::glue('N={N[4]}')) +
theme(legend.position = 'bottom',
legend.title = element_blank()) +
scale_fill_viridis_b(values = c(.2, .4, .6, .8))   +
ggtitle(NULL, subtitle = glue::glue('{nombres_cluster[4]}'))
elsoc_salud_5 %>%
filter(trayectoria == 4) %>%
ggsankey::make_long(depr4_w01, depr4_w02, depr4_w03, depr4_w04, depr4_w05,
value = 'ponderador02_w01') %>%
mutate(depr = factor(node,
levels = 1:4,
labels = c('Sin sintomas', 'medios', 'moderados', 'severos')),
x = factor(x,
levels = glue::glue('depr4_w0{1:5}'),
labels = glue::glue('{c(2016:2019, 2021)}'))) %>%
ggplot(aes(x = x,
next_x = next_x,
node = node,
next_node = next_node,
fill = depr,
value = value)) +
geom_sankey(flow.alpha = .6) +
labs(x = NULL,
caption = glue::glue('N={N[4]}')) +
theme(legend.position = 'bottom',
legend.title = element_blank()) +
scale_fill_viridis_c(values = c(.2, .4, .6, .8))   +
ggtitle(NULL, subtitle = glue::glue('{nombres_cluster[4]}'))
?scale_fill_viridis
elsoc_salud_5 %>%
filter(trayectoria == 4) %>%
ggsankey::make_long(depr4_w01, depr4_w02, depr4_w03, depr4_w04, depr4_w05,
value = 'ponderador02_w01') %>%
mutate(depr = factor(node,
levels = 1:4,
labels = c('Sin sintomas', 'medios', 'moderados', 'severos')),
x = factor(x,
levels = glue::glue('depr4_w0{1:5}'),
labels = glue::glue('{c(2016:2019, 2021)}'))) %>%
ggplot(aes(x = x,
next_x = next_x,
node = node,
next_node = next_node,
fill = depr,
value = value)) +
geom_sankey(flow.alpha = .6) +
labs(x = NULL,
caption = glue::glue('N={N[4]}')) +
theme(legend.position = 'bottom',
legend.title = element_blank()) +
scale_fill_viridis_d(direction = -1, end = .8, values = c(.2, .3, .4, .5))   +
ggtitle(NULL, subtitle = glue::glue('{nombres_cluster[4]}'))
# Crear objeto con secuencias
seq.depr2 <- TraMineR::seqdef(elsoc_salud,
var = c('depr2_w01', 'depr2_w02', 'depr2_w03', 'depr2_w04', 'depr2_w05'),
states = c('Sin síntomas/sintomas medios', 'sintomas moderados/severos'),
labels = c('Sin/medios', 'Moderados/Severos'),
weights = elsoc_salud$ponderador02_w01,
cpal = c('lightgreen', 'slateblue4'))
TraMineR::seqfplot(seq.depr2, border = NA, with.legend = "top",
idxs = 1:260, space = 0)
TraMineR::seqfplot(seq.depr2, border = NA, with.legend = "top",
idxs = 1:100, space = 0)
TraMineR::seqfplot(seq.depr2, border = NA, with.legend = "top",
idxs = 1:25, space = 0)
TraMineR::seqfplot(seq.depr2, border = NA, with.legend = "top",
idxs = 1:25, space = 0)
dist.depr2 <- TraMineR::seqdist(seq.depr2, method = "OM")
?TraMineR::seqdist
dist.depr2 <- TraMineR::seqdist(seq.depr2, method = "OM", sm = NULL)
dist.depr2 <- TraMineR::seqdist(seq.depr2, method = "OM", sm = 'CONSTANT')
TraMineR::seqfplot(seq.depr2, border = NA, with.legend = "top",
idxs = 1:32, space = 0)
# Comparar soluciones con diferentes numeros de trayectorias (se prueban de 2 a 10 clusters)
ward.range.depr2 <- WeightedCluster::as.clustrange(ward.depr2,
diss = dist.depr2,
ncluster = 10)
# Visualizar clusters:
ward.range.depr2$stats %>%
mutate(clusters = 2:10) %>%
pivot_longer(cols = c(ASW, ASWw, HG, PBC, HC),
names_to = 'indicador',
values_to = 'value') %>%
group_by(indicador) %>%
mutate(value = (value - mean(value, na.rm = TRUE)) / sd(value, na.rm = TRUE)) %>%
ggplot(aes(y = value, x = clusters, color = indicador, group = indicador)) +
geom_line() +
scale_x_continuous(breaks = 2:10)
grafico_trayectorias2_K <- function(K, ward) {
elsoc_trayectorias <- elsoc_salud
elsoc_trayectorias$trayectoria <- stats::cutree(ward, k = K)
nested_data <- elsoc_trayectorias %>%
group_by(trayectoria) %>%
nest()
N <- purrr::map(.x = nested_data$data, .f = ~dim(.x)[1])
graficos <- purrr::map2(.x = nested_data$data,
.y = N,
.f = ~ .x %>%
ggsankey::make_long(depr2_w01, depr2_w02, depr2_w03, depr2_w04, depr2_w05,
value = 'ponderador02_w01') %>%
mutate(depr = factor(node,
levels = 1:2,
labels = c('Sin sintomas/medios', 'Síntomas moderados/severos')),
x = factor(x,
levels = glue::glue('depr2_w0{1:5}'),
labels = glue::glue('{c(2016:2019, 2021)}'))) %>%
ggplot(aes(x = x,
next_x = next_x,
node = node,
next_node = next_node,
fill = depr,
value = value)) +
geom_sankey(flow.alpha = .6) +
labs(x = NULL,
caption = glue::glue('N={.y}')) +
theme(legend.position = 'bottom',
legend.title = element_blank()) +
scale_fill_viridis_d(direction = -1, end = .8))
plot <- ggpubr::ggarrange(plotlist = graficos,
common.legend = TRUE, legend = 'bottom')
annotate_figure(plot, top = text_grob(glue::glue('{K} clusters')))
}
purrr::map(.x = 2:7, ward = ward.depr2, .f = grafico_trayectorias2_K)
purrr::map(.x = 2, ward = ward.depr2, .f = grafico_trayectorias2_K)
elsoc_trayectorias <- elsoc_salud
elsoc_trayectorias$trayectoria <- stats::cutree(ward, k = K)
elsoc_trayectorias$trayectoria <- stats::cutree(ward.depr2, k = 2)
nested_data <- elsoc_trayectorias %>%
group_by(trayectoria) %>%
nest()
elsoc_trayectorias %>%
filter(trayectoria == 1) %>%
ggsankey::make_long(depr2_w01, depr2_w02, depr2_w03, depr2_w04, depr2_w05,
value = 'ponderador02_w01') %>%
mutate(depr = factor(node,
levels = 1:2,
labels = c('Sin sintomas/medios', 'Síntomas moderados/severos')),
x = factor(x,
levels = glue::glue('depr2_w0{1:5}'),
labels = glue::glue('{c(2016:2019, 2021)}'))) %>%
elsoc_trayectorias <- elsoc_salud
elsoc_trayectorias <- elsoc_salud
elsoc_trayectorias$trayectoria <- stats::cutree(ward.depr2, k = 2)
elsoc_trayectorias %>%
filter(trayectoria == 1) %>%
ggsankey::make_long(depr2_w01, depr2_w02, depr2_w03, depr2_w04, depr2_w05,
value = 'ponderador02_w01') %>%
mutate(depr = factor(node,
levels = 1:2,
labels = c('Sin sintomas/medios', 'Síntomas moderados/severos')),
x = factor(x,
levels = glue::glue('depr2_w0{1:5}'),
labels = glue::glue('{c(2016:2019, 2021)}')))
elsoc_trayectorias %>%
filter(trayectoria == 1) %>%
ggsankey::make_long(depr2_w01, depr2_w02, depr2_w03, depr2_w04, depr2_w05,
value = 'ponderador02_w01')
grafico_trayectorias2_K <- function(K, ward) {
elsoc_trayectorias <- elsoc_salud
elsoc_trayectorias$trayectoria <- stats::cutree(ward, k = K)
nested_data <- elsoc_trayectorias %>%
group_by(trayectoria) %>%
nest()
N <- purrr::map(.x = nested_data$data, .f = ~dim(.x)[1])
graficos <- purrr::map2(.x = nested_data$data,
.y = N,
.f = ~ .x %>%
ggsankey::make_long(depr2_w01, depr2_w02, depr2_w03, depr2_w04, depr2_w05,
value = 'ponderador02_w01') %>%
mutate(depr = factor(node,
levels = 0:1,
labels = c('Sin sintomas/medios', 'Síntomas moderados/severos')),
x = factor(x,
levels = glue::glue('depr2_w0{1:5}'),
labels = glue::glue('{c(2016:2019, 2021)}'))) %>%
ggplot(aes(x = x,
next_x = next_x,
node = node,
next_node = next_node,
fill = depr,
value = value)) +
geom_sankey(flow.alpha = .6) +
labs(x = NULL,
caption = glue::glue('N={.y}')) +
theme(legend.position = 'bottom',
legend.title = element_blank()) +
scale_fill_viridis_d(direction = -1, end = .8))
plot <- ggpubr::ggarrange(plotlist = graficos,
common.legend = TRUE, legend = 'bottom')
annotate_figure(plot, top = text_grob(glue::glue('{K} clusters')))
}
purrr::map(.x = 2, ward = ward.depr2, .f = grafico_trayectorias2_K)
purrr::map(.x = 2, ward = ward.depr2, .f = grafico_trayectorias2_K)
elsoc_trayectorias <- elsoc_salud
elsoc_trayectorias$trayectoria <- stats::cutree(ward.depr2, k = 2)
elsoc_trayectorias %>%
filter(trayectoria == 1) %>%
ggsankey::make_long(depr2_w01, depr2_w02, depr2_w03, depr2_w04, depr2_w05,
value = 'ponderador02_w01')
mutate(depr = factor(node,
levels = 1:2,
labels = c('Sin sintomas/medios', 'Síntomas moderados/severos')),
x = factor(x,
levels = glue::glue('depr2_w0{1:5}'),
labels = glue::glue('{c(2016:2019, 2021)}')))
grafico_trayectorias4_K <- function(K, ward) {
elsoc_trayectorias <- elsoc_salud
elsoc_trayectorias$trayectoria <- stats::cutree(ward, k = K)
nested_data <- elsoc_trayectorias %>%
group_by(trayectoria) %>%
nest()
N <- purrr::map(.x = nested_data$data, .f = ~dim(.x)[1])
graficos <- purrr::map2(.x = nested_data$data,
.y = N,
.f = ~ .x %>%
ggsankey::make_long(depr4_w01, depr4_w02, depr4_w03, depr4_w04, depr4_w05,
value = 'ponderador02_w01') %>%
mutate(depr = factor(node,
levels = 1:4,
labels = c('Sin sintomas', 'medios', 'moderados', 'severos')),
x = factor(x,
levels = glue::glue('depr4_w0{1:5}'),
labels = glue::glue('{c(2016:2019, 2021)}'))) %>%
ggplot(aes(x = x,
next_x = next_x,
node = node,
next_node = next_node,
fill = depr,
value = value)) +
geom_sankey(flow.alpha = .6) +
labs(x = NULL,
caption = glue::glue('N={.y}')) +
theme(legend.position = 'bottom',
legend.title = element_blank()) +
scale_fill_viridis_d(direction = -1, end = .8,
breaks = c('Sin sintomas', 'medios',
'moderados', 'severos')))
plot <- ggpubr::ggarrange(plotlist = graficos,
common.legend = TRUE, legend = 'bottom')
annotate_figure(plot, top = text_grob(glue::glue('{K} clusters')))
}
purrr::map(.x = 5, ward = ward.depr4, .f = grafico_trayectorias4_K)
?scale_fill_viridis_d
purrr::map(.x = 5, ward = ward.depr4, .f = grafico_trayectorias4_K)
grafico_trayectorias4_K <- function(K, ward) {
elsoc_trayectorias <- elsoc_salud
elsoc_trayectorias$trayectoria <- stats::cutree(ward, k = K)
nested_data <- elsoc_trayectorias %>%
group_by(trayectoria) %>%
nest()
N <- purrr::map(.x = nested_data$data, .f = ~dim(.x)[1])
graficos <- purrr::map2(.x = nested_data$data,
.y = N,
.f = ~ .x %>%
ggsankey::make_long(depr4_w01, depr4_w02, depr4_w03, depr4_w04, depr4_w05,
value = 'ponderador02_w01') %>%
mutate(depr = factor(node,
levels = 1:4,
labels = c('Sin sintomas', 'medios', 'moderados', 'severos')),
x = factor(x,
levels = glue::glue('depr4_w0{1:5}'),
labels = glue::glue('{c(2016:2019, 2021)}'))) %>%
ggplot(aes(x = x,
next_x = next_x,
node = node,
next_node = next_node,
fill = depr,
value = value)) +
geom_sankey(flow.alpha = .6) +
labs(x = NULL,
caption = glue::glue('N={.y}')) +
theme(legend.position = 'bottom',
legend.title = element_blank()) +
scale_fill_viridis_d(direction = -1, end = .8,
drop = FALSE))
plot <- ggpubr::ggarrange(plotlist = graficos,
common.legend = TRUE, legend = 'bottom')
annotate_figure(plot, top = text_grob(glue::glue('{K} clusters')))
}
purrr::map(.x = 5, ward = ward.depr4, .f = grafico_trayectorias4_K)
